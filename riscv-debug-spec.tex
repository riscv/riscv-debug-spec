\documentclass{article}

\usepackage{tabulary}
\usepackage{listings}
\usepackage{algorithmicx}
\usepackage{minted}
\usepackage{program}
\usepackage{graphicx}
\usepackage[colorlinks=true,linkcolor=blue]{hyperref}
\usepackage[nochapter]{vhistory}
\usepackage{siunitx}

% If LaTeX just doesn't do what I want, buy http://www.amazon.com/gp/product/0201362996

% Used for tables that can span pages:
\usepackage{xtab}
\tabletail{\hline \multicolumn{4}{|r|}{{Continued on next page}} \\ \hline}

% Keep spacing normal in enumerated instead of adding extra space between
% items.
\usepackage{enumitem}
%\setlist{nolistsep}

\newenvironment{commentary}
{
   \begin{quotation}
   \noindent
   \small \em
   \rule{\linewidth}{1pt}\\
}
{
   \end{quotation}
}

\newenvironment{steps}[1]
{
   \vspace{1ex}
   \noindent
   #1
   \begin{enumerate}[nosep]
}
{
   \end{enumerate}
   \vspace{1ex}
}


% All registers are named here. That way when we rename one we'll get errors if
% there are still references to the old name.
\usepackage{xspace}
\newcommand{\defregname}[2]{\providecommand{#1}{{\tt #2}\xspace}}
\newcommand{\deffieldname}[2]{\providecommand{#1}{{$|#2|$}\xspace}}
\deffieldname{\Fmprv}{mprv}
\defregname{\Rmstatus}{mstatus}

\defregname{\Azero}{a0}
\defregname{\Aone}{a1}

\defregname{\Rzero}{zero}
\defregname{\Szero}{s0}
\defregname{\Sone}{s1}

\defregname{\Tzero}{t0}

\defregname{\Xzero}{x0}
\defregname{\Xone}{x1}
\defregname{\Xeight}{x8}
\defregname{\Xnine}{x9}
\defregname{\Xten}{x10}
\defregname{\Xeleven}{x11}
\defregname{\Xthirtyone}{x31}
\defregname{\Fone}{f1}
\defregname{\Rpc}{pc}
\defregname{\Rmhartid}{mhartid}
\defregname{\Rmepc}{mepc}

\input{hwbp_registers.tex.inc}
\input{core_registers.tex.inc}
\input{jtag_registers.tex.inc}
\input{dm1_registers.tex.inc}
\input{dm2_registers.tex.inc}
\input{trace_registers.tex.inc}
\input{sample_registers.tex.inc}
\input{abstract_commands.tex.inc}

\input{vc.tex}

\newcommand{\versionnum}{0.13}
\newcommand{\shortdate}{jan24}
\newcommand{\longdate}{January 24, 2017}

\title{RISC-V External Debug Support\\
Version \versionnum\\
\GITHash
}
\author{Tim Newsome \textless tim@sifive.com\textgreater}
\date{\GITAuthorDate}

\begin{document}
\maketitle

{\bf Warning! This draft specification will change before being accepted as
standard, so implementations made to this draft specification will likely not
conform to the future standard.}

\tableofcontents
\listoffigures
\listoftables

\newpage

\section*{Acknowledgments}

I would like to thank the following people for their time, feedback, and ideas:
Bruce Ableidinger,
Krste Asanovic,
Mark Beal,
Monte Dalrymple,
Peter Egold,
Richard Herveille,
Gajinder Panesar,
Klaus Kruse Pedersen,
Antony Pavlov,
Ken Pettit,
Wesley Terpstra,
Megan Wachs,
Stefan Wallentowitz,
Ray Van De Walker,
Andrew Waterman,
and Andy Wright.

\include{introduction}
\include{about}
\include{background}
\include{features}
\include{overview}
\include{dtm}
\include{dm}
\include{hart}
\include{trigger}
\include{jtag_dtm}

\newpage
\appendix

\include{a_if_implementations}
\include{a_if_debugger}
\include{a_trace}
\include{a_future}

\section{Change Log}

\begin{versionhistory}
    \vhEntry{0.10}{Jul 11}{TN}{Version shared for 4th RISC-V Workshop}
    \vhEntry{0.11}{Jul 17}{TN}{Updated Bus Access section}
    \vhEntry{0.11}{Jul 29}{TN}{\Rmcontrol is intended to alias {\tt tdata0}.
        Remove conditional writes.}
    \vhEntry{0.11}{Aug 11}{TN}{Document {\tt wfi} behavior in Halt Mode.
        Core Debug Registers are only accessible in Halt Mode. Removed hwbpcount
        field from \Rdcsr.}
    \vhEntry{0.11}{Aug 22}{TN}{Clarify meaning of $|mode|$ in \Rtselect. All
        triggers are either locked by the debugger, or none are.}
    \vhEntry{0.11}{Aug 23}{TN}{Triggers are locked on an individual basis
        again. See \Fdmode in {\tt tdata0}. The definitions of \Fchain in
        \Rmcontrol has been changed to be easier to explain. Changed
        recommendations on when store hardware breakpoints fire.}
    \vhEntry{0.11}{Aug 25}{TN}{Add \Ftiming to \Rmcontrol. Changed
        encoding of \Faction.}
    \vhEntry{0.11}{Aug 26}{TN}{Document {\tt lr}/{\tt sc} behavior.
        Rename {\tt tdata0}--{\tt tdata2} to {\tt tdata1}--{\tt tdata3}.}
    \vhEntry{0.11}{Sep 6}{TN}{Change Debug Bus to only support simple
        read and write operations.}
    \vhEntry{0.11}{Sep 7}{TN}{Clarify \Fop in \Rdbus.}
    \vhEntry{0.11}{Sep 13}{TN}{Add rough idea of instruction count
        triggers that could be used for single step.}
    \vhEntry{0.11}{Sep 27}{TN}{M-mode writes to triggers with dmode=1 are
        ignored instead of raising an exception.}
    \vhEntry{0.11}{Oct 24}{TN}{Change serial full bit to full/overflow.}
    \vhEntry{0.11}{Nov 2}{TN}{There actually can be side effects to reading
        Debug Bus registers (specifically reading serial data).}
    \vhEntry{0.12}{Nov 10}{TN}{Reduce Debug Bus width to 32 bits. This
        caused a lot of changes in Section~\ref{dm}, and some in
        Section~\ref{dbus}. Read Section~\ref{dbusaccess} to get an idea of how
        that affects the debugger.}
\end{versionhistory}

\end{document}
